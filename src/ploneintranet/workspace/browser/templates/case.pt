<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master">
  <body class="view-secure">
    <metal:statusmessage fill-slot="statusmessage" tal:define="suppress_message python:request.get('suppress_message', False)">
      <metal:macro tal:condition="not:suppress_message" use-macro="context/main_template/macros/statusmessage" />
    </metal:statusmessage>

    <metal:content fill-slot="content"
                   i18n:domain="ploneintranet"
                   tal:define="workspace view/workspace;
                               workspace_url workspace/absolute_url;
                               related_ws view/get_related_workspaces;
                               ws_type workspace/ws_type | string:case;
                               is_archived workspace/archival_date;
                               archived_class python:'workspace-state-archived' if is_archived else ''">
      <div class="application" id="app-space">
        <div id="application-body" class="application-workspace application-${ws_type} project page-type-${ws_type} workspace-type-${ws_type} ${archived_class} sidebar-left-closed sidebar-right-closed">
                      <h1 id="workspace-name">
                <!-- Next link is to lead to landing state of current workspace! -->
                <a href="{{page.url}}" tal:attributes="href workspace_url" tal:content="workspace/Title">{{ page.workspace_name }}</a>
            </h1>

            <div id="document-body">
                <!-- XXX complete integration -->
                <div id="workspace-header" class="pat-bumper ${python:context.hero_image and 'has-hero' or ''}">
                    <img class="hero-image" src="${context/absolute_url}/@@images/hero_image" tal:condition="context/hero_image | nothing">
                    <div class="content">
                        <h1 class="title" id="top" tal:content="here/Title">
                            Open Market Committee
                        </h1>

                        <h2 class="byline">
                            ${python:len(view.member_ids)} <tal:t i18n:translate="">Members</tal:t> <!-- | 223 Followers -->
                        </h2>
                        <form class="pat-inject buttons">
                          <tal:comment condition="nothing">
                            <!-- <a href="/feedback/workspace-settings-members.html#workspace-settings" class="pat-modal iconified icon-cog" data-pat-modal="class: large">Settings</a> -->

<!--                                     <fieldset class="pat-inject pat-subform" data-pat-inject="source: #content; target: #follow-workspace" id="follow-workspace">
                                <button type="submit" class="icon-follow-empty" formaction="/feedback/follow-workspace.html" title="Click to follow Open Market Committee">Follow</button>
                            </fieldset>
-->
<!--                                     <fieldset class="pat-inject pat-subform" data-pat-inject="source: #content; target: #bookmark-workspace" id="bookmark-workspace">

                                    <button type="submit" formaction="/feedback/bookmark-workspace-removed.html" class="icon-bookmark active" title="Remove this workspace from your bookmarks">Bookmarked</button>

                            </fieldset>
-->
                          </tal:comment>
                        </form>
                    </div>
                </div>
                <div id="workspace-messages"
                     tal:condition="related_ws"
                >
                  <p class="message notice">
                    <span tal:omit-tag=""
                          i18n:translate=""
                    >If you use this workspace, you might also be interested in</span>
                    <tal:r repeat="rw related_ws">
                      <a class="icon-workspace"
                         href="${rw/getURL}"
                      >${rw/Title}</a><tal:separator condition="python: not repeat['rw'].end">,
                      </tal:separator></tal:r>.
                  </p>
                </div>

              <div class="workspace-header"
                   tal:define="freeze_view nocall:workspace/freeze-view;
                               is_frozen freeze_view/is_frozen;">
                <article class="rich">
                  <p class="description"
                     tal:content="context/description" />
                </article>
                <div class="timeline-container ${python:'state-frozen' if is_frozen else '' }">
                  <section class="explanation" tal:condition="is_frozen">
                    <h3 class="header" i18n:translate="">Frozen</h3>
                    <p class="reason">
                      <strong class="state" i18n:translate="">Frozen on</strong>
                      â€¢
                      <time class="date">${freeze_view/frozen_date}</time>
                    </p>
                  </section>

                  <ul tal:replace="structure workspace/@@metromap"></ul>
                  <p class="controls" tal:condition="is_frozen">
                    <a class="pat-button pat-modal" href="${workspace_url}/@@panel-unfreeze-case#document-content"
                       i18n:translate="">Unfreeze</a>
                  </p>
                </div>
              </div>

              <!-- Careful. I integrate the newpostbox tile from dashboard here, but the markup is different from the one on a workspace, so this still needs to get fixed -->
              <form tal:condition="view/can_add_status_updates" id="new-post-box" data-tile="./@@newpostbox.tile" tal:attributes="data-tile string:${workspace_url}/@@newpostbox.tile"></form>
              <div id="activity-stream" data-tile="./@@activitystream.tile" tal:attributes="data-tile string:${workspace_url}/@@activitystream.tile" ></div>
              <p id="scroll-to-workspace-top" hidden="">
                  <a href="#top" class="pat-scroll pat-scroll-animated" data-pat-scroll="trigger: auto" i18n:translate="">Scroll back to top</a>
              </p>
              <div id="slcclicktracker"
                   tal:condition="view/include_clicktracker|nothing"
                   tal:attributes="
                     request_url request/getURL;
                     path python:'/'.join(context.getPhysicalPath());
                   "
              ></div>
            </div>
            <aside data-tile="${workspace_url}/@@sidebar.default?groupname=${request/groupname|nothing}"
                   tal:condition="view/show_sidebar"></aside>

            <nav class="navigation workspace-tabs" id="workspace-tabs" data-tile="./@@workspace.tabs.tile" tal:attributes="data-tile string:${workspace_url}/@@workspace.tabs.tile" />
        </div>
      </div>
    </metal:content>
  </body>
</html>
