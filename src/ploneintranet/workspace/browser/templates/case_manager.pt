<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master">

  <body class="view-secure">

    <metal:content fill-slot="content" i18n:domain="ploneintranet">
        <div class="application-case-manager" id="content">
          <div id="document-body">
            <div id="document-content" class="cases-overview">
              <div class="row">

                <aside class="four columns pat-bumper case-filters">
                  <form class="pat-inject pat-autosubmit" action="${context/absolute_url}/case-manager#case-mats"
                        tal:define="sidebar_tile nocall:context/sidebar.settings.advanced">
                    <fieldset class="vertical">
                      <label>
                        <tal:trans i18n:domain="plone" i18n:translate="">Search</tal:trans>
                        <input type="search" name="SearchableText" placeholder="Search in title and description" i18n:attributes="placeholder" value="${request/SearchableText|nothing}"/>
                      </label>
                      <!-- To be defined -->
                      <!-- <label> -->
                      <!--   Role filter -->
                      <!--   <select> -->
                      <!--    <option>Only cases that I manage</option> -->
                      <!--    <option>All cases that I'm involved with</option> -->
                      <!--    <option>All cases that I have access to</option> -->
                      <!--   </select> -->
                      <!-- </label> -->
                      <label tal:define="departments python:view.get_field_indexes('department')"
                             tal:condition="departments"><tal:block i18n:translate="">Department</tal:block> <select name="department">
                          <option value="" i18n:translate="">Pick the responsible department</option>
                          <tal:r tal:repeat="department departments">
                            <option value="${department}" selected="${python: request.get('department') == department and 'selected' or None}">${department}</option>
                          </tal:r>
                        </select>
                      </label>
                      <label><tal:block i18n:translate="">Applicant</tal:block> <input type="text"
                               name="applicant_name"
                               data-pat-autosuggest="ajax-data-type: json; ajax-url: ${context/absolute_url}/applicants.json"
                               class="pat-autosuggest"
                               value="${request/applicant_name|nothing}"
                               i18n:attributes="placeholder"
                               placeholder="Enter the name of the applicant"/>
                      </label>
                      <label><tal:block i18n:translate="">Staff</tal:block>
                        <input type="text"
                               name="staff"
                               data-pat-autosuggest="ajax-data-type: json; maximum-selection-size: 1; ajax-url: ${context/portal_url}/allusers.json; prefill-json: ${view/staff_prefill|nothing};"
                               class="pat-autosuggest"
                               i18n:attributes="placeholder"
                               placeholder="Pick staff" />
                      </label>
                      <label><tal:block i18n:translate="">Case type</tal:block>
                        <select name="case_type" class="focus">
                          <option value="" i18n:translate="">Pick case type</option>
                          <tal:r tal:repeat="case_type python:view.get_field_indexes('case_type')">
                            <option value="${case_type}" selected="${python: request.get('case_type') == case_type and 'selected' or None}">${case_type}</option>
                          </tal:r>
                        </select>
                      </label>
                      <label><tal:block i18n:translate="">Status</tal:block> <select name="status" class="focus">
                          <option value="" i18n:translate="">All</option>
                          <option value="open" selected="${python: request.get('status') == 'open' and 'selected' or None}" i18n:translate="">Open</option>
                          <option value="closed" selected="${python: request.get('status') == 'closed' and 'selected' or None}" i18n:translate="">Closed</option>
                        </select>
                      </label>

                      <label><tal:block i18n:translate="">Scheduled session</tal:block> <input type="text"
                               name="scheduled_session"
                               class="pat-autosuggest"
                               data-pat-autosuggest="ajax-data-type: json; allow-new-words: false; ajax-url: ${context/absolute_url}/scheduled_sessions.json; prefill-json: ${view/scheduled_session_prefill|nothing};"
                               i18n:attributes="placeholder"
                               placeholder="Pick a date"/>
                      </label>

                      <!-- For all date ranges applies, that if no end date is filled in, the end date is today. If no earliest date is filled in, then it will search infinitely far back into the past. -->

                      <fieldset class="group row date-range">
                        <label class="six columns"><tal:block i18n:translate="">Earliest creation date</tal:block> <input i18n:attributes="placeholder" placeholder="YYYY-MM-DD" class="pat-date-picker" type="date" size="8" name="earliest_created" value="${request/earliest_created|nothing}" data-pat-date-picker="behaviour: polyfill; show: date; i18n: ${context/portal_url}/@@date-picker-i18n.json"/>
                        </label>
                        <label class="six columns"><tal:block i18n:translate="">Latest creation date</tal:block> <input i18n:attributes="placeholder" placeholder="YYYY-MM-DD" class="pat-date-picker" type="date" size="8" name="latest_created" value="${request/latest_created|nothing}" data-pat-date-picker="behaviour: polyfill; show: date; i18n: ${context/portal_url}/@@date-picker-i18n.json"/>
                        </label>
                      </fieldset>

                      <fieldset class="group row date-range">
                        <label class="six columns"><tal:block i18n:translate="">Earliest modification date</tal:block> <input i18n:attributes="placeholder" placeholder="YYYY-MM-DD" class="pat-date-picker" type="date" size="8" name="earliest_modified" value="${request/earliest_modified|nothing}" data-pat-date-picker="behaviour: polyfill; show: date; i18n: ${context/portal_url}/@@date-picker-i18n.json"/>
                        </label>
                        <label class="six columns"><tal:block i18n:translate="">Latest modification date</tal:block> <input i18n:attributes="placeholder" placeholder="YYYY-MM-DD" class="pat-date-picker" type="date" size="8" name="latest_modified" value="${request/latest_modified|nothing}" data-pat-date-picker="behaviour: polyfill; show: date; i18n: ${context/portal_url}/@@date-picker-i18n.json"/>
                        </label>
                      </fieldset>

                      <fieldset class="group row date-range">
                        <label class="six columns"><tal:block i18n:translate="">Earliest deadline</tal:block> <input i18n:attributes="placeholder" placeholder="YYYY-MM-DD" class="pat-date-picker" type="date" size="8" name="earliest_due" value="${request/earliest_due|nothing}" data-pat-date-picker="behaviour: polyfill; show: date; i18n: ${context/portal_url}/@@date-picker-i18n.json"/>
                        </label>
                        <label class="six columns"><tal:block i18n:translate="">Latest deadline</tal:block> <input i18n:attributes="placeholder" placeholder="YYYY-MM-DD" class="pat-date-picker" type="date" size="8" name="latest_due" value="${request/latest_due|nothing}" data-pat-date-picker="behaviour: polyfill; show: date; i18n: ${context/portal_url}/@@date-picker-i18n.json"/>
                        </label>
                      </fieldset>
                    </fieldset>
                  </form>
                </aside>

                <div id="case-mats" class="eight columns"
                     tal:define="cases view/cases">

                  <tal:nocases condition="not:cases">
                    <!-- FIXME: needs to be designed -->
                    <p i18n:translate="">No results</p>
                  </tal:nocases>
                  <tal:cases repeat="case cases">
                    <div class="case-mat" tal:define="workspace nocall:case">
                      <article class="summary row">
                        <h2 class="case-title twelve columns">
                          <a target="case" href="${case/url}">${case/title}</a>
                        </h2>
                        <p class="description four columns">
                          ${case/description}
                        </p>
                        <div class="eight columns stats">
                          <p class="stat">
                            <strong class="value">${case/percent_complete}</strong>
                            <em class="name" i18n:translate="">Tasks finished</em>
                          </p>
                          <p class="stat">
                            <strong class="value">${case/days_running}</strong>
                            <em class="name" i18n:translate="">>Days running</em>
                          </p>
                          <p class="stat">
                            <strong class="value">${case/recent_modifications}</strong>
                            <em class="name" i18n:translate="">>Modifications past 7 days</em>
                          </p>
                        </div>
                      </article>
                      <tal:timeline define="workspace_url case/url;
                                            mm_seq case/mm_seq;
                                            transition_icons view/transition_icons;
                                            existing_users_by_id case/existing_users_by_id;
                                            tasks case/tasks;
                                            case_view nocall:case/view;
                                            target string:case">
                        <metal:timeline use-macro="case_view/macros/timeline" />
                      </tal:timeline>
                    </div>
                  </tal:cases>

                  <tal:batchnavigation
                      define="batchnavigation nocall:context/@@batchnavigation"
                      replace="structure python:batchnavigation(cases)" />

                </div>


              </div>

            </div>
          </div>
        </div>
    </metal:content>
  </body>
</html>
