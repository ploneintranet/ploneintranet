<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="ploneintranet.workspace">

  <body class="view-secure">

    <metal:content fill-slot="content">
        <div class="application-case-manager" id="content">
          <div id="document-body">
            <div id="document-content" class="cases-overview">
              <div class="row">

                <aside class="four columns pat-bumper case-filters">
                  <form class="pat-inject pat-autosubmit" action="${context/absolute_url}/case-manager#case-mats"
                        tal:define="sidebar_tile nocall:context/sidebar.settings.advanced">
                    <fieldset class="vertical">
                      <label>
                        <tal:trans i18n:domain="plone" i18n:translate="">Search</tal:trans>
                        <input type="search" name="SearchableText" placeholder="Search in title and description" i18n:attributes="placeholder"/>
                      </label>
                      <!-- To be defined -->
                      <!-- <label> -->
                      <!--   Role filter -->
                      <!--   <select> -->
                      <!--    <option>Only cases that I manage</option> -->
                      <!--    <option>All cases that I'm involved with</option> -->
                      <!--    <option>All cases that I have access to</option> -->
                      <!--   </select> -->
                      <!-- </label> -->
                      <label tal:define="departments python:view.get_field_indexes('department')"
                             tal:condition="departments">
                        Bearbeitende Einheit
                        <select name="department">
                          <option value="">Bearbeitende Einheit auswählen</option>
                          <tal:r tal:repeat="department departments">
                            <option value="${department}">${department}</option>
                          </tal:r>
                        </select>
                      </label>
                      <label>
                        Gesuchsteller
                        <input type="text"
                               name="applicant_name"
                               data-pat-autosuggest="ajax-data-type: json; ajax-url: ${context/absolute_url}/applicants.json"
                               class="pat-autosuggest"
                               placeholder="Namen des Gesuchstellers eintragen"/>
                      </label>
                      <label>
                        Sachbearbeiter
                        <input type="text"
                               name="staff"
                               data-pat-autosuggest="ajax-data-type: json; maximum-selection-size: 1; ajax-url: ${context/absolute_url}/allusers.json"
                               class="pat-autosuggest"
                               placeholder="Sachbearbeiter wählen" />
                      </label>
                      <label>
                        Geschäftstyp
                        <select name="case_type" class="focus">
                          <option value="">Geschäftstyp auswählen</option>
                          <tal:r tal:repeat="case_type python:view.get_field_indexes('case_type')">
                            <option value="${case_type}">${case_type}</option>
                          </tal:r>
                        </select>
                      </label>
                      <label>
                        Status
                        <select name="status" class="focus">
                          <option value="">All</option>
                          <option value="open">Open</option>
                          <option value="closed">Closed</option>
                        </select>
                      </label>

                      <label>
                        Entscheidtermin
                        <input type="text"
                               name="scheduled_session"
                               class="pat-autosuggest"
                               data-pat-autosuggest="ajax-data-type: json; allow-new-words: false; ajax-url: ${context/absolute_url}/scheduled_sessions.json"
                               placeholder="Wählen Sie einen Termin aus."/>
                      </label>

                      <!-- For all date ranges applies, that if no end date is filled in, the end date is today. If no earliest date is filled in, then it will search infinitely far back into the past. -->

                      <fieldset class="group row date-range">
                        <label class="six columns">
                          Earliest creation date <input placeholder="YYYY-MM-DD" class="pat-date-picker" type="date" size="8" name="earliest_created"/>
                        </label>
                        <label class="six columns">
                          Latest creation date <input placeholder="YYYY-MM-DD" class="pat-date-picker" type="date" size="8" name="latest_created"/>
                        </label>
                      </fieldset>

                      <fieldset class="group row date-range">
                        <label class="six columns">
                          Earliest modification date <input placeholder="YYYY-MM-DD" class="pat-date-picker" type="date" size="8" name="earliest_modified"/>
                        </label>
                        <label class="six columns">
                          Latest modification date <input placeholder="YYYY-MM-DD" class="pat-date-picker" type="date" size="8" name="latest_modified"/>
                        </label>
                      </fieldset>

                      <fieldset class="group row date-range">
                        <label class="six columns">
                          Earliest deadline <input placeholder="YYYY-MM-DD" class="pat-date-picker" type="date" size="8" name="earliest_due"/>
                        </label>
                        <label class="six columns">
                          Latest deadline <input placeholder="YYYY-MM-DD" class="pat-date-picker" type="date" size="8" name="latest_due"/>
                        </label>
                      </fieldset>
                    </fieldset>
                  </form>
                </aside>

                <div id="case-mats" class="eight columns"
                     tal:define="cases view/cases">
                  <tal:nocases condition="not:cases">
                    <!-- FIXME: needs to be designed -->
                    <p i18n:translate="">No results</p>
                  </tal:nocases>
                  <tal:cases repeat="case cases">
                    <div class="case-mat">
                      <article class="summary row">
                        <h2 class="case-title twelve columns">
                          <a target="case" href="${case/url}">${case/title}</a>
                        </h2>
                        <p class="description four columns">
                          ${case/description}
                        </p>
                        <div class="eight columns stats">
                          <p class="stat">
                            <strong class="value">${case/percent_complete}</strong>
                            <em class="name">Tasks finished</em>
                          </p>
                          <p class="stat">
                            <strong class="value">${case/days_running}</strong>
                            <em class="name">Days running</em>
                          </p>
                          <p class="stat">
                            <strong class="value">${case/recent_modifications}</strong>
                            <em class="name">Modifications past 7 days</em>
                          </p>
                        </div>
                      </article>
                      <tal:timeline define="workspace_url case/url;
                                            mm_seq case/mm_seq;
                                            transition_icons view/transition_icons;
                                            existing_users_by_id case/existing_users_by_id;
                                            tasks case/tasks;
                                            case_view nocall:case/view;
                                            target string:case">
                        <metal:timeline use-macro="case_view/macros/timeline" />
                      </tal:timeline>
                    </div>
                  </tal:cases>
                </div>


              </div>

            </div>
          </div>
        </div>
    </metal:content>
  </body>
</html>
