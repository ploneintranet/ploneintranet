<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="ploneintranet.theme">

  <body>
    <metal:content fill-slot="content"
                   tal:define="workspace python:view.workspace();
                               workspace_url python:workspace.absolute_url();
                               workspace_id python:workspace.id;
                               workspace_view nocall:workspace/view;
                               read_only python:not view.can_edit">

      <h1 id="workspace-name">
        <a href="${workspace_url}" tal:content="workspace/Title">Title</a>
      </h1>

      <div class="${workspace_id} dark-theme" id="application-body">

        <div id="document-body">
          <form class="document pat-inject" method="POST" action="${context/absolute_url}/view#meta">
            <div class="metadata pat-bumper" id="meta">
              <div class="meta-bar">
                <h1 class="doc-title" id="document-title">
                  ${context/title}
                </h1>
                <input name="title" tal:attributes="disabled read_only" type="text" placeholder="Document title" class="doc-title pat-content-mirror" data-pat-content-mirror="target: #document-title" value="${context/title}" />
                <div class="quick-functions">
                  <a href="#confirm-delete" class="icon-trash iconified">
                    Delete
                  </a>
                  <a href="" class="icon-copy iconified">
                    Copy
                  </a>
                  <a href="#share-panel" class="icon-export iconified pat-modal">
                    Share
                  </a>
                  <a class="icon-info-circle meta-data-toggle iconified">Toggle extra metadata</a>
                  <fieldset class="pat-subform pat-autosubmit pat-inject" data-pat-inject="target: #document-content::before; url: /feedback/banner-notifications.html; source: #workflow-state-changed::element;">
                    <label class="pat-select bare">
                      <select>
                        <option>Private</option>
                        <option>Public</option>
                        <option>Members</option>
                        <option>Pending</option>
                        <option>Logged in</option>
                        <option>Internal</option>
                        <option>External</option>
                      </select>
                    </label>
                  </fieldset>
                  <button type="submit" tal:condition="not:read_only" class="icon-floppy">Save</button>

                </div>
              </div>
              <fieldset class="pat-collapsible closed meta-extra" data-pat-collapsible="trigger: .meta-data-toggle" id="meta-extra">
                <fieldset class="bar">
                  <input type="text" tal:attributes="disabled read_only" class="pat-autosuggest" name="tags" placeholder="Tags" value="${python:','.join(context.subject)}" />
                </fieldset>
                <fieldset class="bar description">
                  <textarea name="description" tal:attributes="disabled read_only" rows="8" title="Description" placeholder="Description">${context/description}</textarea>
                </fieldset>

              </fieldset>
            </div>

            <div id="document-content">
              <div class="document ticket-details">

                <fieldset class="vertical fancy"
                          tal:define="formatted_user_list python:['{0} &lt;{1}&gt;'.format(i['title'], i['id']) for i in context.existing_users()];
                                             auto_suggest_users python:'words: {0}'.format(', '.join(formatted_user_list))">
                  <label class="initiator">
                    Initiator <input class="pat-autosuggest users"  type="text" name="initiator"
                    data-pat-autosuggest="words: Bi Angli &lt;bi.angli@shenzenair.com&gt;, Edmund Hall &lt;edmund.hall@aircanada.com&gt;"
                    tal:attributes="data-pat-autosuggest auto_suggest_users; value context/initiator"/>
                  </label>
                  <br/>
                  <label class="assignee">
                    Assignee <input class="pat-autosuggest users" name="assignee"
                    tal:attributes="data-pat-autosuggest auto_suggest_users; value context/assignee"/>
                  </label>
                  <br/>
                  <label class="date-time">
                    Due date <input type="date" name="due"
                    tal:attributes="value context/due"/>
                  </label>
                  <br/>

                  <tal:case_todo condition="workspace/is_case">
                    <label class="stage milestone">
                      Milestone this task belongs to
                      <select name="milestone" tal:define="mm_seq workspace_view/metromap_sequence">
                        <option></option>
                        <tal:milesstones repeat="milestone mm_seq">
                          <option tal:attributes="value milestone;
                                                  selected python:'selected' if context.milestone == milestone else ''"
                                  tal:content="python:mm_seq[milestone]['title']"/>
                        </tal:milesstones>
                      </select>
                    </label>
                    <br />
                  </tal:case_todo>
                </fieldset>
              </div>
            </div>
          </form>
        </div>

        <aside class="sidebar left tagging-off" id="sidebar" data-tile="plone/new-workspace/@@sidebar.default" tal:attributes="data-tile string:${workspace_url}/@@sidebar.default">
        </aside>
      </div>
      <nav class="navigation workspace-tabs" id="workspace-tabs" data-tile="./@@workspace.tabs.tile" tal:attributes="data-tile string:${workspace_url}/@@workspace.tabs.tile" />

    </metal:content>
  </body>
</html>
