<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      metal:use-macro="context/main_template/macros/master"
      >
<body>

<!-- https://github.com/ploneintranet/ploneintranet.theme/blob/master/prototype/_includes/post.html -->
<metal:macro define-macro="main">

<div i18n:domain="ploneintranet"
     tal:define="
         thread_id here/getId;
     "
     class="post item"
     tal:attributes="id python: thread_id and ('post-%s' % thread_id) or None">
  <div class="post-header">
    <tal:avatar tal:replace="structure view/statusupdate_view/post_avatar" />
    <p class="byline">
      <em class="action" i18n:translate="label_posted">posted</em>
      <time class="datestamp pat-moment" data-pat-moment="format:relative">${view/date}</time>

      <tal:location condition="here/title|nothing">
        in <a href="${here/url}">${here/title}</a>
      </tal:location>

      <!-- XXX: This is not yet implemented -->
      <!--label class="visibility pat-select bare">
      |
        <select>
          <optgroup>
            <option>
              Everyone
            </option>
            <option>
              Trusted users
            </option>
          </optgroup>
          <optgroup>
            <option>
              Workspace so and so
            </option>
            <option>
              Baggage handling regulations
            </option>
            <option>
              Human resources
            </option>
          </optgroup>
        </select>
      </label-->
      <br/>
      <!-- XXX: This is not yet implemented -->
      <!--a href="#" class="iconified icon-cog">Options</a-->
    </p>
  </div>

  <section class="post-content">
    <p tal:content="structure view/statusupdate_view/decorated_text">Comment text</p>
  </section>

  <tal:comment condition="nothing">
  prototype distinguishes:
  - content shares (link, download, view) versus status attachments (download)
  - files (with title, description) versus images (fullwidth)
  - has preview  versus no preview versus preview in progress

  Please study prototype/./_includes/post.html when making changes here.

  NB the prototype assumes that multiple attachments are either all images
  or else are all files. Implementation will need to split that into
  a multi-file + multi-image renderer.
  </tal:comment>

  <tal:attachments repeat="attachment view/statusupdate_view/attachments">
    <tal:def define="is_content python:False;
                     is_image attachment/is_image;
                     has_preview attachment/img_src|nothing">

      <tal:streamonly condition="not:is_content">

        <tal:stream_document condition="not:is_image">
          <section class="document preview"
                   tal:attributes="class python:has_preview and 'document preview' or 'document preview not-possible'">
            <figure>
              <a href="#"
                 i18n:attributes="title"
                 title="Download this file"
                 tal:attributes="href attachment/link">
                <img src="/media/preview_thumb_1.jpg" alt=""
                     tal:condition="has_preview"
                     tal:attributes="src attachment/img_src" />
              </a>
              <figcaption>
                <strong class="title">
                  <a href="#"
                     i18n:attributes="title"
                     title="Download this file"
                     tal:attributes="href attachment/link">
                    <tal:r replace="attachment/title">Projection Material</tal:r>
                  </a>
                  <!-- This needs exposure of all generated thumbs. We can do that and have them accessible, it is just not added here yet. -->
                  <!--span class="page-counter icon-docs">3x</span-->
                  <span class="functions">
                      <a href="#" class="icon iconified icon-download" i18n:attributes="title" title="Download this file" tal:attributes="href attachment/link">Download</a>
                      <!-- XXX gallery not implemented yet -- >
                </strong>
                <!-- no description byline for status attachments -->
              </figcaption>
            </figure>
          </section>
        </tal:stream_document>

        <tal:stream_image condition="is_image">
	  <section class="image preview">
	    <figure>
              <img src="/media/preview_thumb_1.jpg" alt=""
                   tal:condition="has_preview"
                   tal:attributes="src attachment/img_src" />
	    </figure>
	    <p class="overlay" tal:condition="nothing">
              <!-- XXX images gallery view not implemented yet -->
              <!-- XXX images zip download not implemented yet -->
	    </p>
	  </section>
        </tal:stream_image>

      </tal:streamonly>

    </tal:def>
  </tal:attachments>

  <div class="functions">
    <!-- XXX: This is not yet implemented -->
    <a href="#"
       class="share pat-modal"
       tal:attributes="href python: thread_id and ('#share-%s' % thread_id) or None">
       Share <sup class="counter">(0)</sup></a>
    <form tal:replace="structure view/toggle_like" />
  </div>
  <div class="comments"
       id="${string:comments-${thread_id}}">
    <div tal:attributes="id string:comment-trail-${thread_id}">
      <tal:loop
          tal:repeat="comment view/statusupdate_view/comment_views"
          tal:content="structure comment"
      />
    </div>
    <tal:commentable condition="view/statusupdate_view/commentable">
        <tal:define define="
          newpostbox_view nocall:view/newpostbox_view;
          form_id string:comment_box_${thread_id};
          attachment_previews_id string:attachment-previews-${thread_id};
          action string:${view/context_url}/@@newpostbox.tile;
          placeholder view/newpostbox_placeholder;
          portal_url view/portal_url;
          context_url view/context_url;
        ">
          <div id="${string:new-comment-${thread_id}}"></div>
          <metal:block use-macro="here/@@update-social.html/main" />
        </tal:define>
    </tal:commentable>
  </div>

</div>
<div class="share-post-modal" tal:define="thread_id here/getId;" tal:attributes="id python: thread_id and ('share-%s' % thread_id) or None">
    <h3>Share</h3>
    <form tal:attributes="id string:foo-share-${thread_id}"
          class="pat-inject update-social status-attach status-active"
          action="#" data-pat-inject="target: #activity-stream::before">
        <p class="content-mirror"
            ><span class="text"
                      tal:attributes="id string:mirror-foo-share-${thread_id}"
                ><em class="placeholder">Add a comment to your share…</em
            ></span
            ><em class="selected-users"
                    tal:attributes="id string:selected-users-share-${thread_id}"></em
            ><em class="selected-tags"
                tal:attributes="id string:selected-tags-share-${thread_id}"></em
        ></p>
        <textarea placeholder="Add a comment to your share…" class="pat-content-mirror pat-switch focus"
        tal:attributes="data-pat-content-mirror string:target: #mirror-foo-share-${thread_id};
                        data-pat-switch string: #foo-share-${thread_id} status-inactive status-active"
        ></textarea>
        <!-- <a class="iconified icon-attach" href="panel-attachment.html">Attach file or reference</a> -->

        <div tal:define="attachments view/statusupdate_view/attachments;
                     attachment python: attachments and attachments[0] or None;
                     is_content python:False;
                     is_image attachment/is_image | nothing;
                     has_preview attachment/img_src|nothing"
             tal:attributes="class python:has_preview and 'shared-item has-preview' or 'shared-item no-preview not-possible'">

            <div class="preview"
                 tal:condition="has_preview">
                <img src="/media/preview_thumb_1.jpg" alt=""
                     tal:attributes="src attachment/img_src" />
            </div>

            <div class="summary">

                <div class="byline">
                    Posted by <tal:avatar tal:replace="structure view/statusupdate_view/post_avatar" />
                </div>

                <blockquote class="share-quote"
                tal:content="structure context/text" />

            </div>

        </div>

        <div class="button-bar">
            <a class="iconified icon-user-add pat-tooltip inactive" data-pat-tooltip="position: tl; source: ajax; class: mentions;" href="/feedback/panel-mentions.html#content">Mention people</a>

            <a class="iconified icon-tags pat-tooltip inactive" data-pat-tooltip="position: tl; source: ajax; class: tags;" href="/feedback/panel-tags.html#content">Add tags</a>

            <button class="pat-switch close-panel" data-pat-switch="#foo status-* status-inactive" type="submit">Post</button>
            <button class="pat-switch close-panel" data-pat-switch="#foo status-* status-inactive" type="reset">Cancel</button>
            <!-- <a class="iconified icon-users" href="panel-visibility.html">Define who can see this</a> -->

        </div>

    </form>

</div></metal:macro>

</body>
</html>
