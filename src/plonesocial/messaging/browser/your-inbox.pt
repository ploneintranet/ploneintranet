<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">
  <body>
    <div id="social-messages"
        metal:fill-slot="main">

        <tal:c tal:condition="view/your_messages">
            <tal:def tal:define="inbox view/your_messages">

                <div id="message-title-full"
                     tal:condition="python: inbox['view'] != 'small'">
                    <div id="inbox-new-message-full" class="btn"><a href="@@messaging-send">New Message</a></div>
                    <h1>Inbox</h1>
                </div>

                <div id="inbox-messages"
                    tal:attributes="class inbox/view"
                    tal:condition="inbox">
                    <div id="message-title"
                         tal:condition="python: inbox['view'] == 'small'">
                        Inbox
                        <div id="inbox-new-message"><a href="@@messaging-send">New Message</a></div>
                    </div>
                    <tal:rep tal:repeat="convo inbox/conversations">
                        <div tal:attributes="class string:conversations convo-count${convo/new_messages_count}">
                            <div class="social-message-name">
                                <div class="social-message-created">
                                    <tal:block tal:content="python: context.toLocalizedTime(convo['last-updated'], long_format=0)" />
                                </div>
                                <!-- <div class="message-status"
                                    tal:condition="convo/new_messages_count">
                                    <tal:block tal:content="convo/new_messages_count" />
                                </div> -->
                                <tal:block tal:content="convo/fullname" />
                            </div>
                            <tal:c tal:condition="convo/messages">
                                <div class="social-message"
                                    tal:repeat="msg convo/messages">
                                    <tal:block tal:replace="structure msg/sender_img" />
                                    <tal:block tal:content="msg/text" />
                                </div>
                            </tal:c>
                        </div>
                    </tal:rep>
                    <div id="your-messages-inbox"><a tal:attributes="href string: ${context/portal_url}/@@social-inbox">Your Inbox</a></div>
                </div>
                <div id="conversation-content"
                    tal:condition="python: inbox['view'] != 'small'">
                    <h2>Messages With</h2>
                    <tal:rep tal:repeat="msg inbox/display_message">
                        <div class="social-message">
                            <div class="social-message-created">
                                <tal:block tal:content="python: context.toLocalizedTime(msg['created'], long_format=0)" />
                            </div>
                            <tal:block tal:replace="structure msg/sender_img" />
                            <tal:block tal:content="msg/text" />
                            <div class="clearall"></div>
                        </div>
                    </tal:rep>
                </div>
            </tal:def>
        </tal:c>

    <!-- end main -->
    </div>
  </body>
</html>